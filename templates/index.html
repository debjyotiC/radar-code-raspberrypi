<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>RADAR | Occupancy results</title>
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='radar.png') }}">
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f2f2f2;
            margin: 0;
            padding: 0;
        }
        .container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: flex-start;
        }
        .box {
            width: 100%;
            height: 300px;
            margin: 20px;
            background-color: green;
            border: 2px solid black;
            position: relative;
        }
        .box-title {
            position: absolute;
            top: 5px;
            left: 50%;
            transform: translateX(-50%);
            color: black;
            font-weight: bold;
            font-size: 18px;
        }
        #contourPlot {
            margin: 20px;
            width: 100%;
            height: 300px;
        }
        h1 {
            text-align: center;
            color: #0077cc;
        }
        p {
            font-size: 18px;
            text-align: center;
            color: #444444;
        }
    </style>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
    <h1>Occupancy results</h1>
    <div class="container">
        <div class="box" id="predictionBox"></div>
        <div id="contourPlot"></div>
    </div>
    <p>Prediction: <span id="prediction">{{ results['Prediction'] }}</span> at time <span id="time">{{ results['Time'] }}</span></p>
    <audio src="{{ url_for('static', filename='alarm.mp3') }}" id="alarmSound"></audio>
    <script type="text/javascript">
        setInterval(function() {
            location.reload();
        }, 1500); // reload the page every 3 seconds

        // Get the prediction value
        var prediction = "{{ results['Prediction'] }}";

        // Get the box element
        var boxElement = document.getElementById("predictionBox");

        // Get the alarm sound element
        var alarmSound = document.getElementById("alarmSound");

        // Get the prediction element
        var predictionElement = document.getElementById("prediction");

        // Get the time element
        var timeElement = document.getElementById("time");

        // Change the color of the box based on the prediction value
        if (prediction === "occupied_room") {
            boxElement.style.backgroundColor = "red";
            alarmSound.play(); // Play the alarm sound
            predictionElement.style.color = "red";
            timeElement.style.color = "red";
        } else {
            boxElement.style.backgroundColor = "green";
            alarmSound.pause(); // Pause the alarm sound
            predictionElement.style.color = "black";
            timeElement.style.color = "black";
        }

        // Define the x, y, and z arrays for the contour plot
        var x = {{ x.tolist() }};
        var y = {{ y.tolist() }};
        var z = {{ z.tolist() }};

        // Create the contour plot
        var trace = {
            x: x,
            y: y,
            z: z,
            type: 'contour',
            colorscale: 'Viridis'
        };
        var data = [trace];
        var layout = {
            title: 'Range-Doppler Plot',
            autosize: true,
            margin: {
                l: 50,
                r: 50,
                b: 50,
                t: 50,
                pad: 4
            },
            xaxis: {
                title: 'Range (m)'
            },
            yaxis: {
                title: 'Doppler velocity (m/s^2)'
            }
        };
        Plotly.newPlot('contourPlot', data, layout);
    </script>
</body>
</html>
